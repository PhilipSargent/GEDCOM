Seem to have lost anything resembling a bugs file :-( So one job is to
find what we had already documented to fix this. Then add these bugs:

Actually, we seem to have v.021-Bugs as expected, why am I lying ?

1) If you edit an INDI and put something in the PLOT field for a burial,
it is not saved. [If we load a tree with PLOT tags, are we losing them
on save ? I presume not or we have fucked the tree a long time ago.]
So I hope this bug means we don't save from a newly populated PLOT into
the GEDCOM, but that an existing PLOT which is in the structure is not
lost (just not updated if we change it). "grep PLOT MainTree2021.ged"
shows we have been saving PLOT subobjects with our edited tree. Need
to test saving from indiUI. Believed FIXED 2022-02-20

2) If you have an INDI, we seem to have no way to add parents - the idea
was to have an "add" button as works for a spouse in the marriage edit
dbox. This is becoming an urgent issue to fix. It is possibly enough new
code that we should do it as a new code version Indeed, it is more complicated
than the add spouse idiom in the famUI - part of this job was intended to be
done by the indi menu "Attach" item to attach a person to an existing family.
We probably want to avoid having a "Find" button to attach to a parent in
an existing famliy because of the ambiguity and the complexity of a GUI to
resolve that. Rather than two "Add" and two "Find" buttons, we should make it
clear that "Add" will add a new person as one parent, but have a single "Find"
button to go and find an existing FAM. That requires the implementation of a
completions dbox to search for FAM objects similar to the one we have for
INDI objects. This needs a new notes file to explore the ramifications.

2022-02-20 The Add buttons are fully implemented. The FInd button exists but
as yet has no supporting code. It is the family find UI that is now most urgent

3) When a display gets fairly wide, spurious horizontal lines tend to appear
on the left of the tree making it hard to read. This may be an FLTK issue
with a bitmap which is bigger than it expects, but at least needs looking into.

4) Number of INDI/FAM/SOUR/REPO not being maintained [2022-02-13] ah, v021-Bugs
has already noted that the stats seem not to be updating.

5) If you run the code with no tree, it barfs. Either it should not try to open
a display, but instead open an open file dbox (but with a "create new tree"
option somewhere), or, it should just create a new tree and open an INDI edit
dbox, so that the tree display opens with one INDI "<unknown>". Hitting Cancel
on the editINDI dbox should terminate the program cleanly or open an "Are you
sure ?" dialogue (or the Cancel button should be inoperative). Note that we
now treat creation and editing as separate things, so even if you did hit
"Cancel" you would still get an INDI in the tree, just a very anonymous
and minimal one.

6) reports from new uses (!) indicate that multiple marriages with lots of
offspring leave spouses floating in space with no obvious idea where the other
one is. Ideally, we'd like to find space to draw some straight lines to connect
these back (yes, it woud help me, too, I've just got a bit more used to it.

------------------------------------------------------------------------------

XFamily has now been built with several versions of FLTK and on several
platforms (all Linux distros). There are known porting issues and some significant
bugs:

Its a major hack to the Makefile and makeinclude to compile on a new distro.
This should be automatically configured in some way - learn how ./configure
scripts work !! Actually, as long as you do make clean and makedepend, it
seems to be OK - worked on kent/Intrepid, and on wharfe/natty. However,
you do need to do a check for the various -dev libraries.

We should also add the bits and twiddles to automate building RPMs and DEBs,
and port also to other platforms.

On FLTK 1.1.x, we don't seem to have a maximise button on the main window.
This has suddenly re-appeared without code change after I restarted X on
wharfe, which is particularly wierd... now seems to come and go at a whim.
We are now on FLTK 1.3, and I don't think we've see this.

However, if we once maximise, then change curent person to make the displayed
tree bigger, we can no longer make the window maximise - you have to revert
it to small, then maximise again. What should happen is that a window which is
maximised but still smaller than the desktop, should automatically increase in
size to stay maximised.

Aaargh - "make" doesn't have a target to make the messages, so if you don't
copy the messages nor explicitly run the python scripts everything's blank
in the menus etc. :-( DOH ! Same will probably go for the tags. You need to
make those relevant .cxx files depend on MessageSrc and KnownTags. And
remember to update the path to the messages inside xlate.cxx, that really
is poor !

When we change current person, the window gets resized by closing it and opening
it. The Window manager chooses where to open the new window, which is often
somewhere other than where the one we clicked in was. This close/reopen also
causes a big flash and is time-consuming. There must be a cleaner way to do
this.

If changing current person shrinks the window, we don't change something to
ensure that the canvas is inside the window. It could be argued that fltk
ought to do this automatically, but since it doesn't we need to do it. We
should really be setting the extent, and scrolling to put the new current
person somewhere in the middle of the Window. If the window is already the
full height of the current display, we should make the window taller if
necessary to maintain that status, up to the maximum size that will fit in
the desktop. MOSTLY FIXED but if the window gets bigger, the canvas may be
offset to one side or the other (or up/down) leaving a grey area. This also
hapens if you resize the window manually - there's no check and internal
scroll. This *ought* to be a simple fix, but possibly we need an event to
a callback when the window is resized

We need to read some coding standards and add a LOT more comments saying
what each routine is for - it's hard to pick up after a year or ten's
gap...

===========================================================================

ToDo::

Check over code for notes on FAM events to check for similar problems to those
debugged in INDI event code. (As I read this, I note that it is so long ago,
that I have no idea what problems those were... wish I was using CVS for this):

We have a NOTE on a HUSB object which is inaccessible from the code (it's
the one that notes that Kate and Ali should both be WIFE in the civil
partnership). There are a lot of places you could add notes that we don't
really support, although, obviously, we preserve them.

New INDIs are not placed in collating sequence when inserted. This is harmless,
only making the GEDCOM a bit harder to hack by hand later. At the moment, we
don't have code to parse out a surname intelligently as !Family does, although
we do pull out the string between "/" if we are adding a new child to an
existing family. There is a horrible suspicion that the way we've done this
may have side effects (a parent surname seemed to vanish - we may be passing
something by pointer in a way that lets edits feed back - we probably need
a strdup in there somewhere).

We preserve the headers as read. Really, we should replace some of the stuff
with details of X!Family rather than !Family 2.2.7. This is particularly
important in that we currently don't have a way to start a new tree from
scratch so we always generate some initial GEDCOM by hand, or using !Family.

FLTK 1.3 supports UTF-8. We should ensure that all our code is UTF-8 safe, and
change the language in which the GEDCOM is saved to indicate this (there has
been UTF-8 text in the file for many years, and any accented characters that
were in 8-bit Latin1 under RISCOS have been corrupted. We should have been
using ANSEL (an escaped version of 7-bit ASCII). Be aware that trying to use
an XFamily GEDCOM in !Family will cause grief (but it will anyway, since
!Family relies on names being unique in a way that was a nightmare. Since we
fixed this major problem in XFamily, you can readily generate GEDCOM with
which !Family won't cope well (as well any other code that generates GEDCOM,
of course).

Fix destructors to delete everything the constructors did new for. You can turn
on logging to help see if we are doing OK here.

Write code for moving people in the tree - we have menu items for Detach
(remove from a family), Attach (add as a child to a family) and Move (both).
However, we need a search facility to find families on the same lines as
the one for locating people. It is likely that we will remove the Attach
menu item in favour of the Find button in the indiUI to find a parental
family. However, the code to actually do this is still needed.

Implement file choosers for both load and save. DONE for save. Note that
if you save using the file chooser ("save as"), it saves. If you save by
clicking the "save" menu item, it doesn't ! This was done to prevent us
blindly saving over a known good GEDCOM with one which the code might
have broken. As such it is still worthwhile precaution, but the way to
address it is probably to move the file we loaded to a versioned backup
(eg. Maintree.ged.1) and then write the save. That's particularly a good
idea since "Save" was trying to save into /var/tmp and failing silently...

Implement a generic class of "Are you sure?" UIs. Yeah, this is starting
to get important as we now have editing functionality. More to the point
we really could do with some sort of alert boxes as various things are
prevented from happening, but with no useful error messages. We have
done this for the process of quitting by closing views (or choosing
quit in the File-> menu) but in that case don't have an indication of
whether the tree has been edited (you'd need flag as part of the treeinstance
class and in this case you'd need to check for every treeinstance. Since we
really haven't implemented multiple trees, that's onky the one).

One issue is the frequency with which I save INDIs without setting the gender.
An "are you sure you don't know the gender ?" reminder would help. Very
occasionally we don't, but 99%+ of the time it is just a slip-up.

There are minor details

The (person) search box consistently has the same window title - it would
be nice for it to say "search for spouse for... person". This is not very
critical as we only allow one such dbox at a time, so should be obvious
what you are doing.


========== do a public release ============================

Add a search facility - we have one to search for INDI names, we want something
to search for things in notes and sources. We will need one to search for families
to implement moving people from one marriage to another (and for the Find parents
button in indiUI).

Add UIs for WILL and PROBate - these need to be read/write straight away.
Currently we have dead buttons. Wills, I think, are like NOTEs, so implementation
should be fairly easy. PROBate is like an event, so it should really be a tab
on indiUI.

Fix problem loading empty tree. Or indeed starting up with no tree (as you
would to start from scratch). Can we load a GEDCOM with no INDIs ?

File=>New View works, but if you close one view, the whole program stops. FIXED.

We don't load (or save) any choices/preferences. We don't have any code that
takes any notice of the preferences either, so we always show all dates, as GEDCOM
format, we always show all names, including surnames, we always show titles, we
have no control over behaviour with Xref errors on loading, and we can't change
the datestamp format on reports (what reports?).

None of the report-generating code is written.

We don't implement the !Family print stuff. OK, so we don't want drawfiles, but
postscript would be very useful, and a bitmap of the entire canvas ought to be
straightforward... Are there libraries to generate PDFs ? Can we generate stuff
in OO.o formats (really - don't go there) ?

The Goto box has a "help" button which tries to open up a help page concerned
with the completions window. This is not yet written, nor added to the Help
menu on the main window. There's no help for the edit notes dbox. Since the
help is back at v 0.14 and we are now on v 0.21 with some significant new
features to document, this needs a major rewrite.

A problem arises in that FLTK doesn't
seem to provide a way for the user to unset a radio button (ie. to
leave every radio button in a group unset). So if you say that a date
is explicitly gregorian or julian and then realise that you don't actually
know, you can't just unset both buttons. You would need an explicit "unspecified"
button. If you add the full range of date escape specifiers, you would then need
six (Gregorian, Julian, FrenchR, Roman, Hebrew and unspecified). This might be
better implemented as a drop-down list... We added a "default" button as a
stopgap. That's really a misnomer - it should be "unspecified"

Minor: Make 0 NOTE Person <name> become
            0 NOTE Person @indi-id@ <name>
on output, and modify code to deal with both old and new forms on input.
(We didn't do that - instead we kept 0 NOTE Person <name> unchanged for
compatibility with older versions, but added 0 NOTE View @I1862@, which
can occur multiple times if you have multiple views open.

You probably need to reread and understand ../Display4
Then try to figure out what of that we have already done - presumably none
Well, that's out of date - we seem to have done almost all of it. The only
area not dealt with is that of multiple trees in memory and a master window
with a list of active (though possibly closed) views. Just as well, since
../Display4 doesn't seem to be around any more.

Dboxes requiring a rework:

  Possibly famUI - we might want to add tabs for
    Banns               we have these
    Marriage Licence      ... and these in the existing tree
    Annulment           though these are uncommon

We also need to replace the current minimal "Sources" field in the person and
marriage dboxes with a "Sources" button. This will bring up a chooser-type dbox
showing a list of sources associated with the place we clicked the button in,
ie. the marriage, engagement or divorce events for the marriage dbox, or any of
the six tabs on the person dbox, but also, in this case, we want a Sources button
to apply sources to the whole INDI object. Well, v0.14 at least has the buttons :-)

We have defined a way we intend to structure things like a 1 CENS record for an individual,
and things like PROB and WILL should work the same way. So we need to provide a way to get
a dbox for editing this sort of stuff. There are two choices - one is a menu entry for
each type of fact in the pop-up (which could be done with a sub-menu, like the reports one),
or could be done with buttons on the person dbox. In many ways the latter would be cleaner,
but it soon becomes unreasonable, the more types of fact you want to handle, whereas a
sub-menu off the main pop-up is cleanly extensible, so probably the preferred option.



When we click on maximise, window is maximised. But if we then move up the tree to make the
canvas bigger, the icon stays the same and the window behaves as if it was still maximised,
even if it could go bigger within the current desktop. So if you try to make it bigger by
clicking the maximise icon, we shrink it back to its previous size. Maximise then works as
expected, but the first shrink is disconcerting and shouldn't happen. So we need a way to
do several things:
1) If our window is "maximised" and the canvas gets bigger, then the window should get
bigger - that's what "maximised" means. And if the canvas is bigger than the desktop,
then a maximised window should get bigger if the taskbar is hidden. KDE's window
manager does this automatically for Qt-based windows - what message does it send when
the desktop real estate changes, and does fltk trap it ? FLTK certainly provides a flag
we can test...
2) First, we have to find out what happened to the maximise button ... is it likely
that fltk wants a call-back for us to handle a "maximise" event, and since we ain't
got one, the button is no longer available ? But it is - this ust have been an older
FLTK bug.

---------------

We do not have the great screed of code needed to:

remove a single object and any tags which cross reference to it
 (code now written to remove a single subobject from an object. Note
  that the object still exists, it is merely no longer a subobject, so is
  "out of the structure". Cross references to it should still work. This
  is needed to move a child to different parents for example)
insert an object, which, for an INDI, means finding the right point
 alphabetically
massacre the tree

We possibly have a problem with:

managing a display with no people at all in it (try loading an
 empty GEDCOM and see how spectacularly X!Family crashes :-)

The (partial) solution is that if no tree is loaded, we immediately
create a single INDI, add it into a base tree, display that and pop
up an indiUI on that person. Probably "Cancel" should be blocked !
At present, we cannot delete an isolated individual so we will not
be able to delete the last person in a tree.However, we *do* need
a way to delete an isolated individual and choose a new current person.

---------------

Further completions window work:

add code for complete-to-left   DONE
             fuzzy-search       DONE

add code to incorporate INDI-ids, titles and dates in suitable columns DONE
add code to size window appropriately (width determined by code which
 formats columns, height minimised to size of short lists)             DONE
add code to shortcut when only one INDI is found - copy the name into  DONE
 the goto box, rather than doing a goto straightaway

further away - add soundex button for much more fuzzy searches.

---------------

Alpha !Family on RISC OS at least shows Source references for events in Edit
person dbox - these are also needed in X!Family

!Family does completions by hotkey (F1, F2) on many input fields - searches
would also be useful on Mother/Father fields in Edit person dbox (DONE). Usefulness
is doubtful on the Name field, but might be some use when edit person has
been opened in response to a "child" menu item. I would prefer that existing
persons be connected as parent/child by doing edit person on the child and
adding the parents (which you could do with a search, as above). No, this is
not the approach we will take - once we have a facility to search for a family
we will do this through menus. Drag'n'drop is a very distant dream...
Drag'n'drop is indeed distant, but we did implement "Add" and "Find" buttons
to create or connect to parents and this works quite well (as far as we have
implemented it...) and I think is much easier than using menus as proposed
above.

Beware of overloading the neat dboxes for edit person and marriage !!

---------------

So many sources are quoting the IGI that it would be nice to build some
stuff in to support this. For example, a FHL film number like 0952217
(the Source Call Number) should be able to generate a URL like
http://www.familysearch.org/Eng/library/fhlcatalog/filmhitlistframe.asp?display=filmhitlist&filmno=0952217&first=undefined&last=undefined
and allow the user to call up a browser to show that. Or alternatively, it
would be good to provide a way that an SCN visible in a SOUR ref. could
point to a GEDCOM record containing the info that that URL obtains.
I'm not sure how GEDCOM would properly support this, and it might turn
out to be an IP violation in some way...

It's also proved to be a very stupid idea, since all the URLs you found
a decade ago no longer work since the FHL website has been extensively
reworked with no support to find stuff via the old URLs.

There is an official way to cite one of these references, which we
should use in our SOUR structure (in fact, you probably get exactly
what we want if you download GEDCOM from one of these URLs). OK, what
you get is like:

0 HEAD
1 SOUR IGI
2 VERS 5.0
2 NAME International Genealogical Index (R)
2 CORP The Church of Jesus Christ of Latter-day Saints
3 ADDR 50 East North Temple Street
4 CONT Salt Lake City, Utah 84150
2 DATA International Genealogical Index
3 DATE 26 January 2006
3 COPR Copyright (c) 1980, 2002
1 DEST PAF
1 DATE 26 January 2006
2 TIME 01:16:02
1 FILE POOLE
1 GEDC
2 VERS 5.5
2 FORM LINEAGE-LINKED
1 CHAR ANSEL
1 SUBM @SUB01@
1 SUBN @N01@
0 @SUB01@ SUBM
1 NAME Created by FamilySearch (TM) Internet Genealogy Service
1 ADDR 50 East North Temple Street
2 CONT Salt Lake City, Utah 84150
0 @N01@ SUBN
1 DESC 1
1 ORDI N

which is all a standard header (except the 1 FILE POOLE line) which tells you
about the source of the information in the whole file - in this case it is an
abstract from the IGI, so IGI is the source, and some small-scale GEDCOM-handling
agent is the destination (which LDS conventionally represent by saying that the
destination is "Personal Ancestral File" Compare this with our current header
given (some way) below

0 @I500151413865@ INDI
1 NAME JOHN /POOLE/
1 SEX M
1 FAMS @F152050406@
1 SOUR @S01@
2 PAGE Batch #: M062961, Sheet #: 00, Source Call #: 0952217, Printout Call #: NONE, Dates: 1741 - 1837
0 @S01@ SOUR
1 AUTH The Church of Jesus Christ of Latter-day Saints
1 TITL International Genealogical Index (R)
1 PUBL Copyright (c) 1980, 2002, data as of January 26, 2006
1 REPO @R01@
0 @R01@ REPO
1 NAME Family History Library
1 ADDR 35 N West Temple Street
2 CONT Salt Lake City, Utah 84150  USA
0 TRLR

Doesn't actually contain the info that the Source Call would get you, and it attaches
the SOUR reference to the INDI, when, in fact, the record this was derived from was
a marriage entry, and the SOUR ref. should be within the 0 FAM/1 MARR object, as far
as I can see. After all, the fact that we are deriving from this reference is the
information about the marriage, not about the whole FAM object (which includes
all the children, engagement, marriage, divorce, annulment etc. etc.). Similarly,
a record telling us about a christening in a parish register should attach to the
0 INDI/1 CHR object.

Looking at our GEDCOM, we have a "data as of ..." line, but it is for years ago.
We are adding to the GEDCOM from current searches - it is immediately clear that
what is required is a "date retrieved" line of some sort for each source reference,
not for the source itself - we didn't download the entire contents of the LDS site
and then never revisit, which is what that PUBL line would imply.

Although the SOURce is the IGI, the IGI gets its information from the original
documents that were microfilmed under that FHL film number, and whilst we want
to make clear that the information has come from the IGI, not the original, we
most certainly require a pointer to the original source in case it is necessary
to go and check. The Batch and SCN may be enough to relocate the info in IGI,
but don't give any clue as to the reliability of the original source, which is
particularly important, given that IGI contains not only transcripts of
contemporary documents like parish registers, but copies of copies and
undocumented submissions from members of LDS church which are sometimes
difficult to believe, let alone rely on.

0 HEAD
1 SOUR !Family_for_RISC_OS
2 VERS 2.26 2002.11.08
1 GEDC
2 VERS 5.3
2 FORM LINEAGE-LINKED
2 LANG English
1 LANG English
1 SUBM @SUB1@

much later on we have the referent of that SUBM:

0 @SUB1@ SUBM
1 NAME Andrew Waddington
1 ADDR Postal Address at time of submission is Copyright  A.E.R.Waddington 1991
2 CONT It may have changed by the time you read this. Use of post is deprecated
2 CONT and address will only be supplied on email request citing valid need-to-know
2 CONT and undertaking to respect specific and restricted conditions of use.
1 _EMAIL family@absolutely-no-spam.pennine.demon.co.uk

5.5.1 adds an EMAIL tag, so that underline should go. It is part of an address
structure, at the same level as ADDR, so 1 is OK, I think.

We are also increasingly quoting stuff from FreeBMD, from the LDS 1881 census
records, the government 1901 census site and soon from FreeCEN and the 1911
census site. At the moment it's all done by NOTEs and we never record the retrieval
date. The retrieval date doesn't matter inasmuch as no-one can go back to that
date and retrieve it again, but it does matter for evolving resources like
FreeBMD if the retrieval date was when the resource was far less complete
and should be checked again. Come to that, what SOUR and REPO should be
quoted for data from these online sources ? LDS do at least give you a well
defined way of doing that ...

Getting away from the immediate aims of defining a UI for this stuff, we note that
data from the IGI uses a number of structures and fields that we don't bother with.
They use a 1 COPR to define copyright, which we don't. Even if we publish under
a Creative Commons licence, that is only enforceable on material in which we can
legitimately claim copyright. And the software should probably not enforce a CC
licence on GEDCOMs created with it. That leads to a small UI in which the user
can set up a copyright string and choose a licence.

We don't add a
1 DATE
2 TIME

to our file, which we should (and it should be in UT - does GEDCOM allow us
to specify a time zone at all ?)